# AskMe Server

A Node.js backend API built with [Fastify](https://fastify.dev/) and TypeScript. It allows users to create rooms, upload audio snippets and ask questions about the uploaded content. Audio is transcribed and indexed using embeddings generated by Google Gemini.

## Technologies

- **Node.js** with **TypeScript**
- **Fastify** web framework with Zod validation
- **Drizzle ORM** for database access and migrations
- **PostgreSQL** with the [pgvector](https://github.com/pgvector/pgvector) extension
- **Google Gemini** API for transcription, embeddings and answers
- **Docker** and `docker-compose` for the local database

## Project Structure

```
src/
├─ database/        # connection, schema and migrations
├─ http/routes/     # HTTP route handlers
├─ services/        # integrations (Gemini)
├─ env.ts           # environment validation
└─ server.ts        # application entry point
```

## Prerequisites

- Node.js 20+ (tested with Node 22)
- Docker (for PostgreSQL with pgvector)

## Setup

1. **Install dependencies**

   ```bash
   npm install
   ```

2. **Create the environment file**

   Copy `.env.example` to `.env` and adjust the values. You must also provide a `GEMINI_API_KEY`:

   ```bash
   cp .env.example .env
   # edit .env and set GEMINI_API_KEY
   ```

3. **Start the database**

   ```bash
   docker compose up -d
   ```

   This will start a PostgreSQL container with the pgvector extension enabled.

4. **Run migrations**

   ```bash
   npm run db:migrate
   ```

5. *(Optional)* **Seed the database**

   ```bash
   npm run db:seed
   ```

6. **Start the development server**

   ```bash
   npm run dev
   ```

   The server listens on the port defined in `.env` (default `3333`). For production use `npm start`.

## API Endpoints

- `GET /health` – simple health check
- `GET /rooms` – list rooms with question count
- `POST /rooms` – create a new room
- `GET /rooms/:roomId/questions` – list questions for a room
- `POST /rooms/:roomId/questions` – create a question and optionally generate an answer
- `POST /rooms/:roomId/audio` – upload an audio chunk to be transcribed and indexed

An example request collection is provided in [`client.http`](client.http) and can be used with tools like the VS Code REST Client extension.

## Formatting

This project uses [Biome](https://biomejs.dev/) via the `ultracite` preset. Run `npx biome format .` to format the codebase.

## License

MIT
